# åŠ¨æ€ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½ä»‹ç»

GoAgent é‡‡ç”¨å…ˆè¿›çš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒï¼š

- **è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·** - åŸºäºæ—¥æœŸå’Œæ„å»ºæ¬¡æ•°çš„æ™ºèƒ½ç‰ˆæœ¬å·
- **Gitæ ‡ç­¾ç®¡ç†** - è·¨æœºå™¨ç‰ˆæœ¬åŒæ­¥ï¼Œç¡®ä¿ç‰ˆæœ¬å”¯ä¸€æ€§  
- **æ„å»ºæ—¶é—´æ³¨å…¥** - è‡ªåŠ¨è·å–ç¼–è¯‘æ—¶é—´
- **Gitä¿¡æ¯æ³¨å…¥** - è‡ªåŠ¨è·å–Gitæäº¤å“ˆå¸Œå’Œåˆ†æ”¯
- **Goç‰ˆæœ¬æ³¨å…¥** - è‡ªåŠ¨è·å–ç¼–è¯‘æ—¶çš„Goç‰ˆæœ¬
- **è‡ªåŠ¨æ ‡ç­¾åˆ›å»º** - æ„å»ºæˆåŠŸåå¯è‡ªåŠ¨åˆ›å»ºGitæ ‡ç­¾

## ğŸ“ ç‰ˆæœ¬å·æ ¼å¼

**æ ¼å¼ï¼š** `ä¸»ç‰ˆæœ¬.å¹´ä»½.æœˆæ—¥-betaæ„å»ºå·`

**ç¤ºä¾‹ï¼š** `4.13.2025.0831-beta0001`

- `4.13` - ä¸»ç‰ˆæœ¬å·ï¼ˆå¯é…ç½®ï¼‰
- `2025` - å½“å‰å¹´ä»½
- `0831` - å½“å‰æœˆæ—¥ï¼ˆæœˆæ—¥æ ¼å¼ï¼šMMDDï¼‰
- `beta0001` - è‡ªåŠ¨é€’å¢çš„æ„å»ºå·ï¼ˆåŒä¸€å¤©ä»0001å¼€å§‹é€’å¢ï¼‰

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ç‰ˆæœ¬è·å–

**Windowsï¼š**
```cmd
# è·å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬å·
.\scripts\get-version.bat 4.13

# è·å–ç‰ˆæœ¬å·å¹¶åˆ›å»ºGitæ ‡ç­¾
.\scripts\get-version.bat 4.13 tag
```

**Linuxï¼š**
```bash
# è·å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬å·  
./scripts/get-version.sh 4.13

# è·å–ç‰ˆæœ¬å·å¹¶åˆ›å»ºGitæ ‡ç­¾
./scripts/get-version.sh 4.13 tag
```

### 2. æ™ºèƒ½æ„å»ºè„šæœ¬

**Windowsï¼š**
```cmd
# è‡ªåŠ¨ç‰ˆæœ¬æ„å»º
.\scripts\build-version.bat

# æŒ‡å®šå¹³å°æ„å»º
.\scripts\build-version.bat windows

# æ„å»ºå¹¶è‡ªåŠ¨åˆ›å»ºGitæ ‡ç­¾
set AUTO_TAG=1
.\scripts\build-version.bat

# æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬å·ï¼ˆä¸æ¨èï¼Œä¼šè·³è¿‡è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†ï¼‰
.\scripts\build-version.bat windows "1.2.0"
```

**Linuxï¼š**
```bash
# è‡ªåŠ¨ç‰ˆæœ¬æ„å»º
./scripts/build-version.sh

# æŒ‡å®šå¹³å°æ„å»º  
./scripts/build-version.sh linux

# æ„å»ºå¹¶è‡ªåŠ¨åˆ›å»ºGitæ ‡ç­¾
export AUTO_TAG=1
./scripts/build-version.sh
```

### 3. æ‰‹åŠ¨æ„å»ºï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

```bash
# åŸºæœ¬ç‰ˆæœ¬æ³¨å…¥
go build -ldflags="-s -w -X main.Version=4.13.2025.0831-beta0001" -o GoAgent.exe .

# å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥
go build -ldflags="-s -w \
  -X main.Version=4.13.2025.0831-beta0001 \
  -X main.BuildTime='2025-08-31 22:30:49' \
  -X main.GitCommit=$(git rev-parse --short HEAD) \
  -X main.GitBranch=$(git rev-parse --abbrev-ref HEAD) \
  -X main.GoVersion=$(go version | awk '{print $3}')" \
  -o GoAgent.exe .
```

## ğŸ¯ ç‰ˆæœ¬ç®¡ç†åŸç†

### è‡ªåŠ¨é€’å¢é€»è¾‘
1. **Gitæ ‡ç­¾ä¼˜å…ˆ**ï¼šä¼˜å…ˆä»Gitæ ‡ç­¾ä¸­è·å–å½“å¤©æœ€æ–°çš„æ„å»ºå·
2. **æ™ºèƒ½é€’å¢**ï¼šè‡ªåŠ¨æ‰¾åˆ°æœ€å¤§æ„å»ºå·å¹¶é€’å¢
3. **è·¨æœºå™¨åŒæ­¥**ï¼šé€šè¿‡Gitæ ‡ç­¾ç¡®ä¿ä¸åŒæœºå™¨ä¸Šçš„ç‰ˆæœ¬å·ä¸€è‡´æ€§
4. **æœ¬åœ°å¤‡ç”¨**ï¼šå½“Gitä¸å¯ç”¨æ—¶ï¼Œä½¿ç”¨æœ¬åœ°æ–‡ä»¶ `.version-counter` ä½œä¸ºå¤‡ç”¨

### ç‰ˆæœ¬å·ç”Ÿæˆç¤ºä¾‹
```
ç¬¬ä¸€æ¬¡æ„å»ºï¼š4.13.2025.0831-beta0001
ç¬¬äºŒæ¬¡æ„å»ºï¼š4.13.2025.0831-beta0002  
ç¬¬ä¸‰æ¬¡æ„å»ºï¼š4.13.2025.0831-beta0003
æ–°çš„ä¸€å¤©ï¼š  4.13.2025.0901-beta0001
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### è‡ªåŠ¨Gitæ ‡ç­¾åˆ›å»º
```cmd
# Windows - æ„å»ºå¹¶è‡ªåŠ¨åˆ›å»ºæ ‡ç­¾
set AUTO_TAG=1
.\scripts\build-version.bat

# Linux - æ„å»ºå¹¶è‡ªåŠ¨åˆ›å»ºæ ‡ç­¾  
export AUTO_TAG=1
./scripts/build-version.sh
```

### ç‰ˆæœ¬æµ‹è¯•å·¥å…·
```cmd
# Windows - å®Œæ•´ç‰ˆæœ¬ç®¡ç†æµ‹è¯•
.\scripts\test-version.bat

# æµ‹è¯•ä¸åŒä¸»ç‰ˆæœ¬å·
.\scripts\get-version.bat 5.0
```

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º

### æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
```bash
# æ˜¾ç¤ºå®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
.\GoAgent.exe version

# æˆ–ä½¿ç”¨ç®€å†™
.\GoAgent.exe -v
.\GoAgent.exe --version
```

### è¿è¡Œæ—¶ç‰ˆæœ¬æ˜¾ç¤º
ç¨‹åºæ­£å¸¸è¿è¡Œæ—¶ä¹Ÿä¼šåœ¨å¯åŠ¨ä¿¡æ¯ä¸­æ˜¾ç¤ºç‰ˆæœ¬ï¼š

```
========================================
æœåŠ¡ï¼šæ˜Ÿå°˜ä»£ç†(DHAgent)
æè¿°ï¼šæ˜Ÿå°˜ï¼Œåˆ†å¸ƒå¼èµ„æºè°ƒåº¦ï¼Œéƒ¨ç½²äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿æ¥æœåŠ¡ç«¯ï¼Œæ”¯æŒèŠ‚ç‚¹ç›‘æ§ã€è¿œç¨‹å‘å¸ƒã€‚
çŠ¶æ€ï¼šWindows æœåŠ¡è¿è¡Œä¸­
è·¯å¾„ï¼šF:\Project\GoAgent\GoAgent.exe
========================================
DHAgent v4.13.2025.0831-beta0001
æ„å»ºæ—¶é—´: 2025-08-31 22:30:49
Gitæäº¤: 4a0953a (main)
Goç‰ˆæœ¬: go1.25.0
å¯æ‰§è¡Œæ–‡ä»¶: GoAgent.exe
```

## ğŸ” Gitæ ‡ç­¾ç®¡ç†

### æŸ¥çœ‹ç‰ˆæœ¬æ ‡ç­¾
```bash
# æŸ¥çœ‹å½“å¤©æ‰€æœ‰ç‰ˆæœ¬æ ‡ç­¾
git tag -l "4.13.2025.0831-*"

# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬æ ‡ç­¾
git tag -l "*beta*"

# æŸ¥çœ‹æœ€æ–°çš„10ä¸ªæ ‡ç­¾
git tag -l | tail -10
```

### æ ‡ç­¾åŒæ­¥
```bash
# æ‹‰å–è¿œç¨‹æ ‡ç­¾
git fetch --tags

# æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°è¿œç¨‹
git push origin --tags

# åˆ é™¤æœ¬åœ°æ ‡ç­¾
git tag -d "4.13.2025.0831-beta0001"

# åˆ é™¤è¿œç¨‹æ ‡ç­¾
git push origin :refs/tags/"4.13.2025.0831-beta0001"
```

## ï¿½ é…ç½®è¯´æ˜

### ä¸»ç‰ˆæœ¬å·é…ç½®
é»˜è®¤ä¸»ç‰ˆæœ¬å·ä¸º `4.13`ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ä¿®æ”¹ï¼š

```cmd
# ä½¿ç”¨ä¸åŒä¸»ç‰ˆæœ¬å·
.\scripts\get-version.bat 5.0
.\scripts\get-version.bat 1.2
.\scripts\get-version.bat 2024.1
```

### ç¯å¢ƒå˜é‡
| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `AUTO_TAG` | æ„å»ºåè‡ªåŠ¨åˆ›å»ºGitæ ‡ç­¾ | `AUTO_TAG=1` |

### ç‰ˆæœ¬å˜é‡è¯´æ˜
| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `main.AppName` | åº”ç”¨åç§° | `DHAgent` |
| `main.Version` | å®Œæ•´ç‰ˆæœ¬å· | `4.13.2025.0831-beta0001` |
| `main.BuildTime` | æ„å»ºæ—¶é—´ | `2025-08-31 22:30:49` |
| `main.GitCommit` | Gitæäº¤å“ˆå¸Œ | `4a0953a` |
| `main.GitBranch` | Gitåˆ†æ”¯ | `main` |
| `main.GoVersion` | Goç‰ˆæœ¬ | `go1.25.0` |
| `main.ExecutableName` | å¯æ‰§è¡Œæ–‡ä»¶å | `GoAgent.exe` |

## ï¿½ CI/CD é›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
name: Build and Release
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0  # è·å–å®Œæ•´Gitå†å²
        
    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.25
        
    - name: Build with auto version and tag
      run: |
        export AUTO_TAG=1
        ./scripts/build-version.sh all
```

### Jenkins ç¤ºä¾‹
```groovy
pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                script {
                    env.AUTO_TAG = "1"
                    sh './scripts/build-version.sh all'
                }
            }
        }
    }
}
```

## ğŸ”— ç›¸å…³å‘½ä»¤

- `GoAgent.exe help` - æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
- `GoAgent.exe version` - æŸ¥çœ‹å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
- `GoAgent.exe -v` - æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼ˆç®€å†™ï¼‰
- `GoAgent.exe --version` - æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
- `GoAgent.exe status` - æŸ¥çœ‹æœåŠ¡çŠ¶æ€

## ğŸ“š ç›¸å…³è„šæœ¬æ–‡ä»¶

| è„šæœ¬æ–‡ä»¶ | è¯´æ˜ |
|----------|------|
| `scripts/get-version.bat` | Windowsç‰ˆæœ¬å·ç”Ÿæˆè„šæœ¬ |
| `scripts/get-version.sh` | Linuxç‰ˆæœ¬å·ç”Ÿæˆè„šæœ¬ |
| `scripts/build-version.bat` | Windowsæ™ºèƒ½æ„å»ºè„šæœ¬ |
| `scripts/build-version.sh` | Linuxæ™ºèƒ½æ„å»ºè„šæœ¬ |
| `scripts/test-version.bat` | ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæµ‹è¯•è„šæœ¬ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Gitä»“åº“è¦æ±‚** - ç‰ˆæœ¬ç®¡ç†éœ€è¦åœ¨Gitä»“åº“ä¸­è¿è¡Œæ‰èƒ½æ­£å¸¸å·¥ä½œ
2. **æ ‡ç­¾æƒé™** - åˆ›å»ºå’Œæ¨é€Gitæ ‡ç­¾éœ€è¦ç›¸åº”çš„ä»“åº“æƒé™
3. **æ—¶é—´åŒæ­¥** - ç¡®ä¿æ„å»ºæœºå™¨çš„ç³»ç»Ÿæ—¶é—´å‡†ç¡®ï¼Œå½±å“ç‰ˆæœ¬å·ä¸­çš„æ—¥æœŸéƒ¨åˆ†
4. **å¹¶å‘æ„å»º** - å¤šäººåŒæ—¶æ„å»ºæ—¶ï¼Œé€šè¿‡Gitæ ‡ç­¾åŒæ­¥ç¡®ä¿ç‰ˆæœ¬å·ä¸å†²çª
5. **ç½‘ç»œè¿æ¥** - æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“éœ€è¦ç½‘ç»œè¿æ¥
6. **å¤‡ç”¨æœºåˆ¶** - å½“Gitä¸å¯ç”¨æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å¤‡ç”¨æ–¹æ¡ˆ

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: ç‰ˆæœ¬å·æ²¡æœ‰é€’å¢**
A: æ£€æŸ¥æ˜¯å¦åœ¨Gitä»“åº“ä¸­ï¼Œç¡®è®¤Gitæ ‡ç­¾æ˜¯å¦æ­£ç¡®åˆ›å»º

**Q: æ ‡ç­¾æ¨é€å¤±è´¥**  
A: æ£€æŸ¥Gitè¿œç¨‹ä»“åº“æƒé™å’Œç½‘ç»œè¿æ¥

**Q: ä¸åŒæœºå™¨ç‰ˆæœ¬å·ä¸ä¸€è‡´**
A: ç¡®ä¿ä½¿ç”¨ `git fetch --tags` åŒæ­¥è¿œç¨‹æ ‡ç­¾

**Q: æ„å»ºå·è·³è·ƒ**
A: å¯èƒ½å­˜åœ¨å·²åˆ é™¤çš„æœ¬åœ°æ ‡ç­¾ï¼Œæ£€æŸ¥ `git tag -l` è¾“å‡º
